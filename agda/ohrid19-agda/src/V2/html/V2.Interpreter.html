<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>V2.Interpreter</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Interpreter for WHILE language.</a>

<a id="37" class="Comment">-- As computation is not guaranteed to terminate,</a>
<a id="87" class="Comment">-- execution of statements is placed in the Delay monad.</a>

<a id="145" class="Keyword">module</a> <a id="152" href="V2.Interpreter.html" class="Module">V2.Interpreter</a> <a id="167" class="Keyword">where</a>

<a id="174" class="Keyword">open</a> <a id="179" class="Keyword">import</a> <a id="186" href="Library.html" class="Module">Library</a>
<a id="194" class="Keyword">open</a> <a id="199" class="Keyword">import</a> <a id="206" href="V2.WellTypedSyntax.html" class="Module">V2.WellTypedSyntax</a>
<a id="225" class="Keyword">open</a> <a id="230" class="Keyword">import</a> <a id="237" href="V2.Value.html" class="Module">V2.Value</a>

<a id="247" class="Comment">-- Evaluation of expressions in fixed environment ρ.</a>

<a id="301" class="Keyword">module</a> <a id="EvalExp"></a><a id="308" href="V2.Interpreter.html#308" class="Module">EvalExp</a> <a id="316" class="Symbol">{</a><a id="317" href="V2.Interpreter.html#317" class="Bound">Γ</a><a id="318" class="Symbol">}</a> <a id="320" class="Symbol">(</a><a id="321" href="V2.Interpreter.html#321" class="Bound">ρ</a> <a id="323" class="Symbol">:</a> <a id="325" href="V2.Value.html#388" class="Function">Env</a> <a id="329" href="V2.Interpreter.html#317" class="Bound">Γ</a><a id="330" class="Symbol">)</a> <a id="332" class="Keyword">where</a>

  <a id="EvalExp.eval"></a><a id="341" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="346" class="Symbol">:</a> <a id="348" class="Symbol">∀{</a><a id="350" href="V2.Interpreter.html#350" class="Bound">t</a><a id="351" class="Symbol">}</a> <a id="353" class="Symbol">(</a><a id="354" href="V2.Interpreter.html#354" class="Bound">e</a> <a id="356" class="Symbol">:</a> <a id="358" href="V2.WellTypedSyntax.html#582" class="Datatype">Exp</a> <a id="362" href="V2.Interpreter.html#317" class="Bound">Γ</a> <a id="364" href="V2.Interpreter.html#350" class="Bound">t</a><a id="365" class="Symbol">)</a> <a id="367" class="Symbol">→</a> <a id="369" href="V2.Value.html#150" class="Function">Val</a> <a id="373" href="V2.Interpreter.html#350" class="Bound">t</a>
  <a id="377" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="382" class="Symbol">(</a><a id="383" href="V2.WellTypedSyntax.html#632" class="InductiveConstructor">eInt</a>  <a id="389" href="V2.Interpreter.html#389" class="Bound">i</a><a id="390" class="Symbol">)</a>        <a id="399" class="Symbol">=</a> <a id="401" href="V2.Interpreter.html#389" class="Bound">i</a>
  <a id="405" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="410" class="Symbol">(</a><a id="411" href="V2.WellTypedSyntax.html#695" class="InductiveConstructor">eBool</a> <a id="417" href="V2.Interpreter.html#417" class="Bound">b</a><a id="418" class="Symbol">)</a>        <a id="427" class="Symbol">=</a> <a id="429" href="V2.Interpreter.html#417" class="Bound">b</a>
  <a id="433" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="438" class="Symbol">(</a><a id="439" href="V2.WellTypedSyntax.html#933" class="InductiveConstructor">eVar</a> <a id="444" href="V2.Interpreter.html#444" class="Bound">x</a><a id="445" class="Symbol">)</a>         <a id="455" class="Symbol">=</a> <a id="457" href="V2.Value.html#419" class="Function">lookupEnv</a> <a id="467" href="V2.Interpreter.html#321" class="Bound">ρ</a> <a id="469" href="V2.Interpreter.html#444" class="Bound">x</a>
  <a id="473" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="478" class="Symbol">(</a><a id="479" href="V2.WellTypedSyntax.html#775" class="InductiveConstructor">eOp</a> <a id="483" href="V2.WellTypedSyntax.html#464" class="InductiveConstructor">plus</a> <a id="488" href="V2.Interpreter.html#488" class="Bound">e₁</a> <a id="491" href="V2.Interpreter.html#491" class="Bound">e₂</a><a id="493" class="Symbol">)</a> <a id="495" class="Symbol">=</a> <a id="497" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="502" href="V2.Interpreter.html#488" class="Bound">e₁</a> <a id="505" href="Data.Integer.Base.html#2950" class="Function Operator">+</a> <a id="507" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="512" href="V2.Interpreter.html#491" class="Bound">e₂</a>
  <a id="517" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="522" class="Symbol">(</a><a id="523" href="V2.WellTypedSyntax.html#775" class="InductiveConstructor">eOp</a> <a id="527" href="V2.WellTypedSyntax.html#486" class="InductiveConstructor">gt</a>  <a id="531" href="V2.Interpreter.html#531" class="Bound">e₁</a> <a id="534" href="V2.Interpreter.html#534" class="Bound">e₂</a><a id="536" class="Symbol">)</a>  <a id="539" class="Symbol">=</a> <a id="541" href="V2.Value.html#686" class="Function">iGt</a> <a id="545" class="Symbol">(</a><a id="546" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="551" href="V2.Interpreter.html#531" class="Bound">e₁</a><a id="553" class="Symbol">)</a> <a id="555" class="Symbol">(</a><a id="556" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="561" href="V2.Interpreter.html#534" class="Bound">e₂</a><a id="563" class="Symbol">)</a>
  <a id="567" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="572" class="Symbol">(</a><a id="573" href="V2.WellTypedSyntax.html#775" class="InductiveConstructor">eOp</a> <a id="577" href="V2.WellTypedSyntax.html#509" class="InductiveConstructor">and</a> <a id="581" href="V2.Interpreter.html#581" class="Bound">e₁</a> <a id="584" href="V2.Interpreter.html#584" class="Bound">e₂</a><a id="586" class="Symbol">)</a>  <a id="589" class="Symbol">=</a> <a id="591" href="Function.html#3662" class="Function Operator">case</a> <a id="596" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="601" href="V2.Interpreter.html#581" class="Bound">e₁</a> <a id="604" href="Function.html#3662" class="Function Operator">of</a> <a id="607" class="Symbol">λ</a> <a id="609" class="Keyword">where</a>
    <a id="619" href="V2.AST.html#496" class="InductiveConstructor">true</a>  <a id="625" class="Symbol">→</a> <a id="627" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="632" href="V2.Interpreter.html#584" class="Bound">e₂</a>
    <a id="639" href="V2.AST.html#501" class="InductiveConstructor">false</a> <a id="645" class="Symbol">→</a> <a id="647" href="V2.AST.html#501" class="InductiveConstructor">false</a>
  <a id="655" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="660" class="Symbol">(</a><a id="661" href="V2.WellTypedSyntax.html#856" class="InductiveConstructor">eCond</a> <a id="667" href="V2.Interpreter.html#667" class="Bound">e₁</a> <a id="670" href="V2.Interpreter.html#670" class="Bound">e₂</a> <a id="673" href="V2.Interpreter.html#673" class="Bound">e₃</a><a id="675" class="Symbol">)</a> <a id="677" class="Symbol">=</a> <a id="679" href="Function.html#3662" class="Function Operator">case</a> <a id="684" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="689" href="V2.Interpreter.html#667" class="Bound">e₁</a> <a id="692" href="Function.html#3662" class="Function Operator">of</a> <a id="695" class="Symbol">λ</a> <a id="697" class="Keyword">where</a>
    <a id="707" href="V2.AST.html#496" class="InductiveConstructor">true</a>  <a id="713" class="Symbol">→</a> <a id="715" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="720" href="V2.Interpreter.html#670" class="Bound">e₂</a>
    <a id="727" href="V2.AST.html#501" class="InductiveConstructor">false</a> <a id="733" class="Symbol">→</a> <a id="735" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="740" href="V2.Interpreter.html#673" class="Bound">e₃</a>

<a id="744" class="Keyword">open</a> <a id="749" href="V2.Interpreter.html#308" class="Module">EvalExp</a>

<a id="758" class="Comment">-- Execution of declarations, extending the environment.</a>

<a id="execDecl"></a><a id="816" href="V2.Interpreter.html#816" class="Function">execDecl</a> <a id="825" class="Symbol">:</a> <a id="827" class="Symbol">∀{</a><a id="829" href="V2.Interpreter.html#829" class="Bound">Γ</a> <a id="831" href="V2.Interpreter.html#831" class="Bound">t</a><a id="832" class="Symbol">}</a> <a id="834" class="Symbol">(</a><a id="835" href="V2.Interpreter.html#835" class="Bound">d</a> <a id="837" class="Symbol">:</a> <a id="839" href="V2.WellTypedSyntax.html#1050" class="Datatype">Decl</a> <a id="844" href="V2.Interpreter.html#829" class="Bound">Γ</a> <a id="846" href="V2.Interpreter.html#831" class="Bound">t</a><a id="847" class="Symbol">)</a> <a id="849" class="Symbol">(</a><a id="850" href="V2.Interpreter.html#850" class="Bound">ρ</a> <a id="852" class="Symbol">:</a> <a id="854" href="V2.Value.html#388" class="Function">Env</a> <a id="858" href="V2.Interpreter.html#829" class="Bound">Γ</a><a id="859" class="Symbol">)</a> <a id="861" class="Symbol">→</a> <a id="863" href="V2.Value.html#388" class="Function">Env</a> <a id="867" class="Symbol">(</a><a id="868" href="V2.Interpreter.html#831" class="Bound">t</a> <a id="870" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="872" href="V2.Interpreter.html#829" class="Bound">Γ</a><a id="873" class="Symbol">)</a>
<a id="875" href="V2.Interpreter.html#816" class="Function">execDecl</a> <a id="884" class="Symbol">(</a><a id="885" href="V2.WellTypedSyntax.html#1090" class="InductiveConstructor">dInit</a> <a id="891" href="V2.Interpreter.html#891" class="Bound">e</a><a id="892" class="Symbol">)</a> <a id="894" href="V2.Interpreter.html#894" class="Bound">ρ</a> <a id="896" class="Symbol">=</a> <a id="898" href="V2.Interpreter.html#341" class="Function">eval</a> <a id="903" href="V2.Interpreter.html#894" class="Bound">ρ</a> <a id="905" href="V2.Interpreter.html#891" class="Bound">e</a> <a id="907" href="Data.List.Relation.Unary.All.html#1256" class="InductiveConstructor Operator">∷</a> <a id="909" href="V2.Interpreter.html#894" class="Bound">ρ</a>

<a id="execDecls"></a><a id="912" href="V2.Interpreter.html#912" class="Function">execDecls</a> <a id="922" class="Symbol">:</a> <a id="924" class="Symbol">∀{</a><a id="926" href="V2.Interpreter.html#926" class="Bound">Γ</a> <a id="928" href="V2.Interpreter.html#928" class="Bound">Γ&#39;</a><a id="930" class="Symbol">}</a> <a id="932" class="Symbol">(</a><a id="933" href="V2.Interpreter.html#933" class="Bound">ds</a> <a id="936" class="Symbol">:</a> <a id="938" href="V2.WellTypedSyntax.html#1129" class="Datatype">Decls</a> <a id="944" href="V2.Interpreter.html#926" class="Bound">Γ</a> <a id="946" href="V2.Interpreter.html#928" class="Bound">Γ&#39;</a><a id="948" class="Symbol">)</a> <a id="950" class="Symbol">(</a><a id="951" href="V2.Interpreter.html#951" class="Bound">ρ</a> <a id="953" class="Symbol">:</a> <a id="955" href="V2.Value.html#388" class="Function">Env</a> <a id="959" href="V2.Interpreter.html#926" class="Bound">Γ</a><a id="960" class="Symbol">)</a> <a id="962" class="Symbol">→</a> <a id="964" href="V2.Value.html#388" class="Function">Env</a> <a id="968" href="V2.Interpreter.html#928" class="Bound">Γ&#39;</a>
<a id="971" href="V2.Interpreter.html#912" class="Function">execDecls</a> <a id="981" href="V2.WellTypedSyntax.html#1165" class="InductiveConstructor">[]</a>       <a id="990" href="V2.Interpreter.html#990" class="Bound">ρ</a> <a id="992" class="Symbol">=</a> <a id="994" href="V2.Interpreter.html#990" class="Bound">ρ</a>
<a id="996" href="V2.Interpreter.html#912" class="Function">execDecls</a> <a id="1006" class="Symbol">(</a><a id="1007" href="V2.Interpreter.html#1007" class="Bound">d</a> <a id="1009" href="V2.WellTypedSyntax.html#1183" class="InductiveConstructor Operator">∷</a> <a id="1011" href="V2.Interpreter.html#1011" class="Bound">ds</a><a id="1013" class="Symbol">)</a> <a id="1015" href="V2.Interpreter.html#1015" class="Bound">ρ</a> <a id="1017" class="Symbol">=</a> <a id="1019" href="V2.Interpreter.html#912" class="Function">execDecls</a> <a id="1029" href="V2.Interpreter.html#1011" class="Bound">ds</a> <a id="1032" class="Symbol">(</a><a id="1033" href="V2.Interpreter.html#816" class="Function">execDecl</a> <a id="1042" href="V2.Interpreter.html#1007" class="Bound">d</a> <a id="1044" href="V2.Interpreter.html#1015" class="Bound">ρ</a><a id="1045" class="Symbol">)</a>

<a id="1048" class="Comment">-- Execution of the program (main loop).</a>

<a id="runProgram"></a><a id="1090" href="V2.Interpreter.html#1090" class="Function">runProgram</a> <a id="1101" class="Symbol">:</a> <a id="1103" class="Symbol">(</a><a id="1104" href="V2.Interpreter.html#1104" class="Bound">prg</a> <a id="1108" class="Symbol">:</a> <a id="1110" href="V2.WellTypedSyntax.html#1319" class="Record">Program</a><a id="1117" class="Symbol">)</a> <a id="1119" class="Symbol">→</a> <a id="1121" href="Agda.Builtin.Int.html#219" class="Datatype">ℤ</a>
<a id="1123" href="V2.Interpreter.html#1090" class="Function">runProgram</a> <a id="1134" class="Symbol">(</a><a id="1135" href="V2.WellTypedSyntax.html#1353" class="InductiveConstructor">program</a> <a id="1143" href="V2.Interpreter.html#1143" class="Bound">ds</a> <a id="1146" href="V2.Interpreter.html#1146" class="Bound">e</a><a id="1147" class="Symbol">)</a> <a id="1149" class="Symbol">=</a>

  <a id="1154" class="Comment">-- Execute the declarations to get the initial environment ρ.</a>
  <a id="1218" class="Keyword">let</a> <a id="1222" href="V2.Interpreter.html#1222" class="Bound">ρ</a> <a id="1224" class="Symbol">=</a> <a id="1226" href="V2.Interpreter.html#912" class="Function">execDecls</a> <a id="1236" href="V2.Interpreter.html#1143" class="Bound">ds</a> <a id="1239" href="Data.List.Relation.Unary.All.html#1239" class="InductiveConstructor">[]</a> <a id="1242" class="Keyword">in</a>

  <a id="1248" class="Comment">-- Evaluate the main expression to yield result.</a>
  <a id="1299" href="V2.Interpreter.html#341" class="Function">EvalExp.eval</a> <a id="1312" href="V2.Interpreter.html#1222" class="Bound">ρ</a> <a id="1314" href="V2.Interpreter.html#1146" class="Bound">e</a>
</pre></body></html>